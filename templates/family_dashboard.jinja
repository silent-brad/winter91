<!-- This file is ignored per requirements. Use select-runner.jinja and add-runner.jinja instead -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Dashboard - Winter 100</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <script src="https://unpkg.com/htmx.org@2.0.2"></script>
    <link rel="icon" type="image/svg+xml" href="/static/images/logo.svg">
    <style>
        .runner-card {
            border: 2px solid var(--pico-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .runner-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid;
        }
        .runner-info {
            flex-grow: 1;
        }
        .runner-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }
        .add-runner-form {
            border: 2px dashed var(--pico-border-color);
            border-radius: var(--pico-border-radius);
            padding: 1rem;
            margin-top: 1rem;
        }
        .color-preview {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <nav class="container">
        <ul>
            <li><strong><a href="/"><img src="/static/images/logo.svg" alt="Winter100 Logo" style="height:2rem;width:2rem;"> Winter 100</a></strong></li>
        </ul>
        <ul>
            {% if session.is_some() %}
            <li><a href="/family-dashboard">Family Dashboard</a></li>
            <li><a href="/logout">Logout</a></li>
            {% else %}
            <li><a href="/login">Login</a></li>
            <li><a href="/signup">Signup</a></li>
            {% endif %}
        </ul>
    </nav>

    <main class="container">
        <h1>Family Dashboard</h1>
        <p>Welcome to your family account! Manage your family's runner accounts below.</p>

        {% if error_message.is_some() %}
        <div class="error" style="background-color: var(--pico-del-background-color); color: var(--pico-del-color); padding: 1rem; border-radius: var(--pico-border-radius); margin-bottom: 1rem;">
            {{ error_message.get() }}
        </div>
        {% endif %}

        {% if success_message.is_some() %}
        <div class="success" style="background-color: var(--pico-ins-background-color); color: var(--pico-ins-color); padding: 1rem; border-radius: var(--pico-border-radius); margin-bottom: 1rem;">
            {{ success_message.get() }}
        </div>
        {% endif %}

        <h2>Family Runners</h2>
        
        {% if runners.len == 0 %}
        <p>No runners created yet. Add your first family member below!</p>
        {% else %}
        {% for runner in runners %}
        <div class="runner-card" style="border-color: {{ runner.color }};">
            {% if runner.avatar_filename != "" %}
            <img src="/static/uploads/{{ runner.avatar_filename }}" alt="{{ runner.name }}" class="runner-avatar" style="border-color: {{ runner.color }};">
            {% else %}
            <div class="runner-avatar" style="background-color: {{ runner.color }}; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border-color: {{ runner.color }};">
                {{ runner.name[0..0] }}
            </div>
            {% endif %}
            <div class="runner-info">
                <h3 class="runner-name" style="color: {{ runner.color }};">{{ runner.name }}</h3>
                <p>Created: {{ runner.created_at }}</p>
                {% if runner.has_custom_avatar %}
                <small>Custom avatar uploaded</small>
                {% else %}
                <small>Generated avatar (updates with name changes)</small>
                {% endif %}
            </div>
            <div>
                <button class="secondary" onclick="editRunner({{ runner.id }}, '{{ runner.name }}', '{{ runner.color }}')">Edit</button>
                <button class="secondary outline" onclick="deleteRunner({{ runner.id }}, '{{ runner.name }}')">Delete</button>
            </div>
        </div>
        {% endfor %}
        {% endif %}

        <div class="add-runner-form">
            <h3>Add New Runner</h3>
            <form hx-post="/create-runner" hx-target="#runner-response">
                <div class="grid">
                    <div>
                        <label for="name">Name</label>
                        <input type="text" id="name" name="name" required maxlength="50">
                    </div>
                    <div>
                        <label for="color">Color</label>
                        <div style="display: flex; align-items: center;">
                            <input type="color" id="color" name="color" value="#3b82f6" onchange="updateColorPreview()">
                            <span class="color-preview" id="colorPreview" style="background-color: #3b82f6;"></span>
                        </div>
                    </div>
                </div>
                <button type="submit">Add Runner</button>
            </form>
            <div id="runner-response"></div>
        </div>

    </main>

    <script>
        function updateColorPreview() {
            const colorInput = document.getElementById('color');
            const colorPreview = document.getElementById('colorPreview');
            colorPreview.style.backgroundColor = colorInput.value;
        }

        function editRunner(runnerId, name, color) {
            // TODO: Implement edit runner functionality
            alert('Edit runner functionality coming soon!');
        }

        function deleteRunner(runnerId, name) {
            if (confirm('Are you sure you want to delete ' + name + '? This will also delete all their miles and posts.')) {
                // TODO: Implement delete runner functionality
                alert('Delete runner functionality coming soon!');
            }
        }
    </script>
</body>
</html>
