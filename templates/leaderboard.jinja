{% extends "partials/_master.jinja" %}

{% block title %}Leaderboard{% endblock %}

{% block content %}
<article>
  <section>
    <h1>Leaderboard</h1>
    <p>Track everyone's progress towards the Winter 100 goal!</p>
  </section>
	
	{% if success_message.is_some() %}
		<div class="success" style="
			background-color: var(--success-oklch-500);
			color: var(--neutral-oklch-50);
			padding: 1rem;
			border-radius: 0.375rem;
			margin-bottom: 1rem;
		">
			{{success_message.get()}}
		</div>
	{% endif %}
	
	<div id="leaderboard-table" class="overflow-auto">
		<!-- Leaderboard table will be loaded here -->
		<div style="text-align: center; padding: 2rem;">
			<div aria-busy="true">Loading leaderboard...</div>
		</div>
	</div>
</article>
{%endblock%}

{% block extra_js %}
<script>
	async function loadLeaderboardTable() {
		try {
			const response = await fetch('/api/leaderboard-table');
			if (response.ok) {
				const html = await response.text();
				document.getElementById('leaderboard-table').innerHTML = html;
			} else {
				document.getElementById('leaderboard-table').innerHTML =
					'<p style="text-align: center; color: var(--color-text-muted); margin: 2rem 0;">Error loading leaderboard</p>';
			}
		} catch (error) {
			document.getElementById('leaderboard-table').innerHTML =
				'<p style="text-align: center; color: var(--color-text-muted); margin: 2rem 0;">Error loading leaderboard</p>';
		}
	}

	// Load leaderboard on page load
	document.addEventListener('DOMContentLoaded', loadLeaderboardTable);

	// Auto-refresh leaderboard every 30 seconds
	setInterval(loadLeaderboardTable, 30000);
</script>
{% endblock %}
