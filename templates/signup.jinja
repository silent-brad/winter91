{% extends "partials/_master.jinja" %}

{% block title %}Sign Up{% endblock %}

{% block content %}
<article class="form-container">
  <header>
	<h1>Sign Up</h1>
	<p>Join the Winter 91 challenge!</p>
  
  <div id="signup-messages">
	{% if error_message.is_some() %}
	  <div class="error">
      {{error_message.get()}}
	  </div>
	{% endif %}
	
	{% if success_message.is_some() %}
	  <div class="success">
      {{success_message.get()}}
	  </div>
	{% endif %}
  </div>
  
  <form id="family-form" method="post" action="/signup"
		hx-post="/signup"
		hx-target="#signup-messages"
		hx-swap="innerHTML">
    <label for="family-passkey">
      Invitation Code
      <input
      type="text"
      id="family-passkey"
      name="passkey"
      placeholder="Enter invitation code"
      required
      >
      <small>You need a valid invitation code to join.</small>
    </label>
    
    <label for="family-email">
      Email
      <input 
      type="email" 
      id="family-email" 
      name="email" 
      placeholder="Enter family account email"
      required
      >
    </label>
    
    <label for="family-password">
      Password
      <div class="password-field">
        <input 
        type="password" 
        id="family-password" 
        name="password" 
        placeholder="Create a password"
        minlength="8"
        required
        >
        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('family-password')">
          <span class="toggle-icon">üëÅÔ∏è</span>
        </button>
      </div>
      <small>Password must be at least 8 characters long.</small>
    </label>
    
    <label for="family-confirm_password">
      Confirm Password
      <div class="password-field">
        <input 
        type="password" 
        id="family-confirm_password" 
        name="confirm_password" 
        placeholder="Confirm your password"
        minlength="8"
        required
        >
        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('family-confirm_password')">
          <span class="toggle-icon">üëÅÔ∏è</span>
        </button>
      </div>
    </label>
    
    <button type="submit">Create Family Account</button>
  </form>
  
  <footer class="text-center">
	<p>
	  Already have an account? 
	  <a href="/login">Log in here</a>
	</p>
  </footer>
</article>
{% endblock %}

{% block extra_js %}
<script>
  document.getElementById('family-confirm_password').addEventListener('input', function() {
	const password = document.getElementById('family-password').value;
	const confirm_password = this.value;
	
	if (password !== confirm_password) {
	  this.setCustomValidity('Passwords do not match');
	} else {
	  this.setCustomValidity('');
	}
  });
</script>
{% endblock %}
